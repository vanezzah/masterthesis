---
title: "Plot"
output: html_document
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)

```

plots
```{r}
install.packages('ggpubr')
library(ggpubr)
```


Effect plots model 1

Making mnlogit output the same as multinom (example)

```{r}

#Source: https://stackoverflow.com/questions/43623076/multinomial-logit-in-r-mlogit-versus-nnet/43697814

mlogitSample_test <- mlogit.data(HH_dt_model2, choice = "anzauto", shape = "wide") 

fm_test <- formula(anzauto ~ 1 | anzfs + region + hheink_imp + quali_nv + berufstaetige + householdtype+ CS + Weglänge_avg + anzmots + anzahl2039 + haustyp + quali_opnv + anzahl65 + Bildung + bahn28 + garage)
fit_test <- mnlogit(fm_test, mlogitSample_test, ncores=2, choiceVar = "alt")

fit_multitest <- multinom(anzauto ~ anzfs + region + hheink_imp+ quali_nv + berufstaetige + householdtype + CS +Weglänge_avg + anzmots + anzahl2039 + haustyp + quali_opnv + anzahl65 + Bildung + bahn28 + garage, data = HH_dt_model2)


fit_multitest <- multinom(anzauto ~ anzfs  + berufstaetige +, data = HH_dt_model2)
fm_test <- formula(anzauto ~ 1| anzfs + berufstaetige )
fit_test <- mnlogit(fm_test, mlogitSample_test, ncores=2, choiceVar = "alt")

#substitution of coefficients
fit_multitest2 <- fit_multitest
cf <- matrix(fit_multitest2$wts, nrow=4) # 1 + die anzahl an variablen
fit_test.cf <- coef(fit_test)
cf[2:nrow(cf), 2:ncol(cf)] <- (matrix(fit_test.cf,nrow=3)) #anzahl der levels der dependent variable -1

# Substitution of probabilities
fit_multitest2$wts <- c(cf)
fit_multitest2$fitted.values <- fit_test$probabilities

plot(effect("anzfs", fit_multitest2), multiline=TRUE, x.var = "anzfs", rug=FALSE)

# für andere
plot(effect("hheink_imp", fit_multinom), multiline=TRUE, rug=FALSE)

```


Making mnlogit output the same as multinom (normal)
```{r}



fit_multinom <- multinom(numcars ~numlic + region2 + income_numerical + I(numlic^2) + 
    quali_nv + I(income_numerical^2) + CSyes + workers + CSmultiple + 
    log(nummots1) + triplength_avg + housing_type + quali_opnv + 
    I(triplength_avg^2) + oldHH + parttime + hh_children + numped + 
    tripsavg + metro28 + train28 + garage + bus28 + I(parttime^2), data = HH_dt_2_out,maxit=250)


fm_new <- formula(numcars ~  1| numlic + region2 + income_numerical + I(numlic^2) + 
    quali_nv + I(income_numerical^2) + CSyes + workers + CSmultiple + 
    log(nummots1) + triplength_avg + housing_type + quali_opnv + 
    I(triplength_avg^2) + oldHH + parttime + hh_children + numped + 
    tripsavg + metro28 + train28 + garage + bus28 + I(parttime^2)|1)
fit_new <- mlogit(fm_new, mnlogit_dt_out, ncores=4, choiceVar = "alt")


#substitution of coefficients
fit_multinom_v3 <- fit_multinom
cf2 <- matrix(fit_multinom_v3$wts, nrow=39) # davor 39 
fit_new.cf <- coef(fit_new)
cf2[2:nrow(cf2), 2:ncol(cf2)] <- (matrix(fit_new.cf,nrow=3))

# Substitution of probabilities
fit_multinom_v3$wts <- c(cf2)
fit_multinom_v3$fitted.values <- fit_new$probabilities


e1 = effect("triplength_avg", fit_multinom2)
e1 = as.data.frame(e1)
e2 = effect("income_numerical", fit_multinom2, xlevels = 20)
e2 = as.data.frame(e2)
e3 = effect("numlic", fit_multinom2)
e3 <- as.data.frame(e3)
e4 = effect("tripsavg", fit_multinom2)
e4 <- as.data.frame(e4)

e5 = effect("log(nummots1)", fit_multinom2)
e5 <- as.data.frame(e5)
e6 = effect("numped", fit_multinom)
e6 <- as.data.frame(e6)

e10 =  effect("workers", fit_multinom, xlevels=4)
e10 <- as.data.frame(e10)
e11 =effect("parttime", fit_multinom, xlevels =4)
e11 <- as.data.frame(e11)


e13 = effect("oldHH", fit_multinom)
e13 <- as.data.frame(e13)

e14 = effect("CSyes", fit_multinom2)
e14 <- as.data.frame(e14)
e15 = effect("CSmultiple", fit_multinom2)
e15 <- as.data.frame(e15)

e16 = effect("region2", fit_multinom2)
e16 <- as.data.frame(e16)

e17 = effect("bus28", fit_multinom2)
e17 <- as.data.frame(e17)
e18 = effect("metro28", fit_multinom2)
e18 <- as.data.frame(e18)
e19 = effect("train28", fit_multinom2)
e19 <- as.data.frame(e19)

e20 = effect("housing_type", fit_multinom2)
e20 <- as.data.frame(e20)
e21 = effect("garage", fit_multinom2)
e21<- as.data.frame(e21)

e22 = effect("quali_opnv", fit_multinom2)
e22 <- as.data.frame(e22)
e23 = effect("quali_nv", fit_multinom2)
e23 <- as.data.frame(e23)

e24 = effect("hh_children", fit_multinom2)
e24 <- as.data.frame(e24)
  




```


effects 28.12.
```{r}
e33 = effect("numlic", fit_multinom_v3)
e33 <- as.data.frame(e33)

e111 = effect("triplength_avg", fit_multinom_v3)
e111 = as.data.frame(e111)
e2222 = effect("income_numerical", fit_multinom_v3, xlevels = 20)
e2222 = as.data.frame(e2222)
e44 = effect("tripsavg", fit_multinom_v3)
e44 <- as.data.frame(e44)

e55 = effect("log(nummots1)", fit_multinom_v3)
e55 <- as.data.frame(e55)
e66 = effect("numped", fit_multinom_v3)
e66 <- as.data.frame(e66)

e100 =  effect("workers", fit_multinom_v3, xlevels=4)
e100 <- as.data.frame(e100)
e1111 =effect("parttime", fit_multinom_v3, xlevels =4)
e1111 <- as.data.frame(e1111)

e144 = effect("CSyes", fit_multinom_v3)
e144 <- as.data.frame(e144)
e155 = effect("CSmultiple", fit_multinom_v3)
e155 <- as.data.frame(e155)


e133 = effect("oldHH", fit_multinom_v3)
e133 <- as.data.frame(e133)
e244 = effect("hh_children", fit_multinom_v3)
e244 <- as.data.frame(e244)


e177 = effect("bus28", fit_multinom_v3)
e177 <- as.data.frame(e177)
e188 = effect("metro28", fit_multinom_v3)
e188 <- as.data.frame(e188)
e199 = effect("train28", fit_multinom_v3)
e199 <- as.data.frame(e199)

e200 = effect("housing_type",fit_multinom_v3)
e200 <- as.data.frame(e200)
e211 = effect("garage", fit_multinom_v3)
e211<- as.data.frame(e211)
e166 = effect("region2", fit_multinom_v3)
e166 <- as.data.frame(e166)

e222 = effect("quali_opnv", fit_multinom_v3)
e222 <- as.data.frame(e222)
e233 = effect("quali_nv", fit_multinom_v3)
e233 <- as.data.frame(e233)



```




Plots with gg plot
numlic
```{r}

numlic_plot <-ggplot(data=e33, aes(x=numlic))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Number of licensed drivers")+
      ggtitle("Licenses")+
      labs(color = "Number of cars owned") +
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      coord_fixed(ratio=4)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#numlic_plot
```


income numerical 

```{r}

income_plot <-ggplot(data=e2222, aes(x=income_numerical))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Monthly Income in Thousands")+
      ggtitle("Income")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=9)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        legend.position = "bottom",
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#income_plot


figure_incnum <- ggarrange(numlic_plot, income_plot,common.legend = TRUE, legend = "right", vjust=6,hjust=-0.6, ncol = 2, nrow = 1, align="h")

#%>% gridExtra::grid.arrange(get_legend(income_plot), heights = unit(c(60, 5), "mm"))


annotate_figure(figure_incnum,
                left = text_grob("Predicted Probability", color = "black", rot = 90)
)


```
Carsharing

```{r}
CS1_plot <-ggplot(data=e144, aes(x=CSyes, group=1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Carsharing available")+
      ggtitle("Carsharing available")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=2)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      scale_x_discrete(labels = c("0" = "No", "1" = "Yes"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()


CS2_plot <-ggplot(data=e155, aes(x=CSmultiple, group=1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three cars"))+
      ylab("")+
      xlab("Multiple carsharing subscriptions")+
      ggtitle("Multiple carsharing subscriptions")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=2)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_x_discrete(labels = c("0" = "No", "1" = "Yes"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        legend.position = "bottom",
        panel.grid.minor=element_blank())+
      scale_fill_grey()



figure_CS <- ggarrange(CS1_plot,common.legend = TRUE, legend = "right",
          ncol = 2, nrow = 1)
#%>% gridExtra::grid.arrange(get_legend(CS2_plot), heights = unit(c(60, 5), "mm"))


annotate_figure(figure_CS,
                left = text_grob("Predicted Probability", color = "black", rot = 90)
)
```



Tripsavg and triplength_avg

```{r}


trips_plot <-ggplot(data=e44, aes(x=tripsavg))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Average number of trips")+
      ggtitle("Av. trips")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=8)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()

triplength_plot <-ggplot(data=e111, aes(x=triplength_avg))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("Predicted probability")+
      xlab("Average triplength")+
      ggtitle("Av. triplength")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=34)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        legend.position = "bottom",
        plot.margin=unit(c(0,0,0,0),"pt"),
        panel.grid.minor=element_blank())+
      scale_fill_grey()



figure_trips <- ggarrange(triplength_plot,common.legend = TRUE, legend = "right", vjust=6,
          ncol = 2, nrow = 1)

#%>% gridExtra::grid.arrange(get_legend(triplength_plot), heights = unit(c(60, 5), "mm"))


annotate_figure(figure_trips,
                left = text_grob("Predicted Probability", color = "black", rot = 90)
)

require(tikzDevice)
tikz('test3.tex')

print(ggplot(data=e111, aes(x=triplength_avg))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Average triplength")+
      ggtitle("Av. triplength")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=34)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        legend.position = "bottom",
        plot.margin=unit(c(0,0,0,0),"pt"),
        panel.grid.minor=element_blank())+
      scale_fill_grey())

figure_trips <- ggarrange(triplength_plot,common.legend = TRUE, legend = "right", vjust=6,
          ncol = 2, nrow = 1)

#%>% gridExtra::grid.arrange(get_legend(triplength_plot), heights = unit(c(60, 5), "mm"))


print(annotate_figure(figure_trips,
                left = text_grob("Predicted Probability", color = "black", rot = 90)
))

savepdf("test7")
annotate_figure(figure_trips,
                left = text_grob("Predicted Probability", color = "black", rot = 90))
dev.off()

savepdf <- function(file, width=16, height=6.5)
{
  fname <- paste(file,".pdf",sep="")
  pdf(fname, width=width/2.54, height=height/2.54,
      pointsize=10)
  par(mgp=c(2.2,0.45,0), tcl=-0.4, mar=c(3.3,3.6,1.1,1.1))
}




```

workers and parttime

```{r}

workers_plot <-ggplot(data=e100, aes(x=workers))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Number of fulltime workers")+
      ggtitle("Fulltime workers")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=3)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        legend.position = "bottom",
        panel.grid.minor=element_blank())+
      scale_fill_grey()
workers_plot

parttime_plot <-ggplot(data=e1111, aes(x=parttime))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Number of parttime workers")+
      ggtitle("Parttime workers")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=3)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        legend.position = "bottom",
        panel.grid.minor=element_blank())+
      scale_fill_grey()



figure_trips <- ggarrange(workers_plot, parttime_plot,common.legend = TRUE, legend = "right", vjust=2,
          ncol = 2, nrow = 1)
#%>% gridExtra::grid.arrange(get_legend(region_plot), heights = unit(c(60, 5), "mm"))


annotate_figure(figure_trips,
                left = text_grob("Predicted Probability", color = "black", rot = 90)
)
```

hh_children and region

```{r}

children_plot <-ggplot(data=e244, aes(x=hh_children, group = 1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Household with children")+
      ggtitle("Children")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=2)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      scale_x_discrete(labels = c("0" = "No", "1" = "Yes"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        axis.text.x = element_text(angle=45, hjust=1),
        panel.grid.minor=element_blank())+
      scale_fill_grey()


old_plot <-ggplot(data=e133, aes(x=oldHH, group=1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Age of household")+
      ggtitle("Prevailing household age")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=2)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      scale_x_discrete(limits=c("0","1"),labels = c("0" = "<= 36", "1" = "> 36"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
              axis.text.x = element_text(angle=45, hjust=1),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
share2_plot


figure_chidold<- ggarrange(children_plot, old_plot,common.legend = TRUE, legend = "right", vjust=2,
          ncol = 2, nrow = 1, align = "h")

#%>% gridExtra::grid.arrange(get_legend(region_plot), heights = unit(c(60, 5), "mm"))


annotate_figure(figure_chidold,
                left = text_grob("Predicted Probability", color = "black", rot = 90)
)

```

numped and nummots


```{r}
numped_plot <-ggplot(data=e66, aes(x=numped))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Number of bikes / ped.")+
      ggtitle("Bikes")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=10)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_x_continuous(limits=c(0,10), breaks = c(0,2,4,6,8,10))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()

nummots_plot <-ggplot(data=e55, aes(x=nummots1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Number of motorbikes")+
      ggtitle("Motorbikes")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=4)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()




figure_pedmots<- ggarrange(numped_plot, nummots_plot,common.legend = TRUE, legend = "right", vjust=6,
          ncol = 2, nrow = 1)


annotate_figure(figure_pedmots,
                left = text_grob("Predicted Probability", color = "black", rot = 90)
)
```


train bus metro
```{r}
train_plot <-ggplot(data=e199, aes(x=train28, group=1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("")+
      ggtitle("Train")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=3)+
   scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_x_discrete(labels = c("middle"="medium","rfar" = "really far"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        axis.text.x = element_text(angle=45, hjust=1), 
        panel.grid.minor=element_blank())+
      scale_fill_grey()

bus_plot <-ggplot(data=e177, aes(x=bus28, group=1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      ylab("")+
      xlab("")+
      ggtitle("Bus")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=3)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_x_discrete(labels = c("middle"="medium", "rfar" = "really far"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        axis.text.x = element_text(angle=45, hjust=1), 
        legend.position = "bottom",
        panel.grid.minor=element_blank())+
      scale_fill_grey()
bus_plot

metro_plot <-ggplot(data=e188, aes(x=metro28, group = 1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("")+
      ggtitle("Metro")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=3)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
   scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      scale_x_discrete(labels = c("middle"="medium", "rfar" = "really far"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        axis.text.x = element_text(angle=45, hjust=1),     
        panel.grid.minor=element_blank())+
      scale_fill_grey()




figure_bus<- ggarrange(bus_plot, metro_plot,train_plot,common.legend = TRUE, legend = c("none"), vjust=4,
          ncol = 3, nrow = 1) %>% gridExtra::grid.arrange(get_legend(bus_plot), heights = unit(c(60, 5), "mm"))


annotate_figure(figure_bus,
                left = text_grob("Predicted Probability", color = "black", rot = 90),
                bottom=text_grob("Distance to next station", color="black",vjust=-10)
)
```


housing type and garage

```{r}

region_plot <-ggplot(data=e166, aes(x=region2, group=1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three cars"))+
      ylab("")+
      xlab("")+
      ggtitle("Regional area")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=2.25)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_x_discrete(labels = c("urban" = "Urban", "suburban" = "Suburban","rural"= "Rural"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        legend.position="bottom",
        axis.text.x = element_text(angle=45, hjust=1),
        panel.grid.minor=element_blank())+
      scale_fill_grey()


housing_plot <-ggplot(data=e200, aes(x=housing_type, group=1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("")+
      ggtitle("Housingtype")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=2.25)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
   #scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three cars"))+
      scale_x_discrete(limits = c("singlefamily_h", "multifamily_h", "apartmentbuilding"), labels = c("singlefamily_h" = "Singlefamily-Home", "multifamily_h" = "Multifamily-Home","apartmentbuilding" = "Apartment"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        axis.text.x = element_text(angle=45,hjust=1),
        panel.grid.minor=element_blank())+
      scale_fill_grey()

garage_plot <-ggplot(data=e211, aes(x=garage, group=1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("")+
      ggtitle("Garage")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=1.5)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_x_discrete(labels = c("0" = "No garage", "1" = "Garage available"))+
  # scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        axis.text.x = element_text(angle=45, hjust=1),
        panel.grid.minor=element_blank())+
      scale_fill_grey()




figure_housing<- ggarrange(housing_plot, garage_plot,region_plot, common.legend = TRUE, legend = "top", hjust=10,align = "h",
          ncol = 3, nrow = 1) 
#%>% gridExtra::grid.arrange(get_legend(bus_plot), heights = unit(c(-100, 5), "mm"))


annotate_figure(figure_housing,
                left = text_grob("Predicted Probability", color = "black", rot = 90)
)
```

qualinv, qualiopnv


```{r}
qualinv_plot <-ggplot(data=e233, aes(x=quali_nv, group=1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Quality of public services")+
      ggtitle("Public services")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=4)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      #scale_x_discrete(labels = c("0" = "No", "1" = "Yes"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()

qualiopnv_plot <-ggplot(data=e222, aes(x=quali_opnv, group=1))+
      geom_line(aes(y=prob.X0, color="Zero cars")) + 
      geom_line(aes(y=prob.X1, color="One car")) + 
      geom_line(aes(y=prob.X2, color ="Two cars"))+
      geom_line(aes(y=prob.X3, color ="Three or more cars"))+
      ylab("")+
      xlab("Quality of public transport")+
      ggtitle("Public transport")+
      labs(color = "Number of cars owned") +
      coord_fixed(ratio=4)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_color_discrete(breaks = c("Zero cars", "One car","Two cars", "Three or more cars"))+
      #scale_x_discrete(labels = c("0" = "urban", "1" = "suburban","2"= "rural"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()




figure_quali<- ggarrange(qualinv_plot, qualiopnv_plot,common.legend = TRUE, legend = "right", vjust=6,
          ncol = 2, nrow = 1)


annotate_figure(figure_quali,
                left = text_grob("Predicted Probability", color = "black", rot = 90)
)
```


Effect plots interaction effects 

```{r}

multinom_int <- multinom(numcars ~ region2 + numlic + I(numlic^2) + region2:numlic + region2:I(numlic^2) + income_numerical +I(income_numerical^2)+ region2:income_numerical + region2:I(income_numerical^2) + quali_nv + region2:quali_nv + CSyes + region2:CSyes + workers+ I(workers^2)+region2:workers +region2:I(workers^2)+ triplength_avg+ I(triplength_avg^2)+ region2:triplength_avg+ region2:I(triplength_avg^2) + log(nummots1) + region2:log(nummots1) +housing_type + region2:housing_type+ garage +region2:garage+ quali_opnv + region2:quali_opnv+oldHH + region2:oldHH +CSmultiple+region2:CSmultiple+ hh_children + region2:hh_children + metro28 + region2:metro28+tripsavg + I(tripsavg^2)+region2:tripsavg+ parttime + I(parttime^2) + region2:parttime+ train28 + region2:train28 +numped + I(numped^2) + region2:numped + region2:I(numped^2) + bus28+ region2:bus28, data = HH_dt_2_out, maxit=700)

fm_int <- formula(numcars ~  1|region2 + numlic + I(numlic^2) + region2:numlic + region2:I(numlic^2) + income_numerical +I(income_numerical^2)+ region2:income_numerical + region2:I(income_numerical^2) + quali_nv + region2:quali_nv+CSyes + region2:CSyes + workers+ I(workers^2)+ region2:workers + triplength_avg+ I(triplength_avg^2)+ region2:triplength_avg+ region2:I(triplength_avg^2) + log(nummots1) + housing_type + garage + quali_opnv + share2039 + I(share2039^2)  +  region2:share2039 + region2:I(share2039^2) + share4064 + CSmultiple+ hh_children + region2:hh_children + metro28 +tripsavg + parttime + train28 +numped + I(numped^2) + region2:numped + region2:I(numped^2) +bus28|1)
#qualinv2 + qualinv3 + qualinv4+ region2:qualinv2 + region2:qualinv3  + region2:qualinv4

fit_int <- mnlogit(fm_int, mnlogit_dt_out, ncores=4, choiceVar = "alt")


#substitution of coefficients
multinom_int2 <- multinom_int
cf2 <- matrix(multinom_int2$wts, nrow=71) # davor 39 
fit_interaction.cf <- coef(fit_interaction)
cf2[2:nrow(cf2), 2:ncol(cf2)] <- (matrix(fit_interaction.cf,nrow=3))

# Substitution of probabilities
multinom_int2$wts <- c(cf2)
multinom_int2$fitted.values <- fit_interaction$probabilities

#compute and manipulate all effects
library(effects)
#qualinv4
ef <- effect("region2:quali_nv", multinom_int2) #nur rural and urban und nur 1 und 2
ef <- as.data.frame(ef)

#numlic
ef2 <- effect("region2:numlic", multinom_int2)
ef2 <- as.data.frame(ef2)


#income_numerical
ef3 <- effect("region2:income_numerical", multinom_int2)#bei rural nicht 1
ef3 <- as.data.frame(ef3)

#Csyes
ef4 <- effect("region2:CSyes", multinom_int2) #nursuburban, alle
temp <- ef4
ef4 <- as.data.frame(ef4)


ef5 <- effect("region2:workers", multinom_int2) # alles 
ef5 <- as.data.frame(ef5)
ef12 <- effect("region2:parttime", multinom_int2) # alles 
ef12 <- as.data.frame(ef12)

ef6 <- effect("region2:triplength_avg", multinom_int2) #nur suburban significant, alle levels
ef6 <- as.data.frame(ef6)

ef7 <- effect("region2:oldHH", multinom_int2) #nur rural, alle levels
ef7 <- as.data.frame(ef7)

ef8 <- effect("region2:hh_children", multinom_int2) #nur carownership 2 bei suburban, 2 und 3 bei rural
ef8 <- as.data.frame(ef8)


ef9 <- effect("region2:numped", multinom_int2) #bei rural level1 nicht (2 plots)
ef9 <- as.data.frame(ef9)


ef10 <- effect("region2:quali_opnv", multinom_int2) #bei rural level1 nicht (2 plots)
ef10 <- as.data.frame(ef10)

ef11 <- effect("region2:CSmultiple", multinom_int2) #bei rural level1 nicht (2 plots)
ef11 <- as.data.frame(ef11)

ef13 <- effect("region2:housing_type", multinom_int2) #bei rural level1 nicht (2 plots)
ef13 <- as.data.frame(ef13)

ef18 <- effect("region2:garage", multinom_int2) #bei rural level1 nicht (2 plots)
ef18 <- as.data.frame(ef18)

ef14 <- effect("region2:metro28", multinom_int2) #bei rural level1 nicht (2 plots)
ef14 <- as.data.frame(ef14)

ef15 <- effect("region2:train28", multinom_int2) #bei rural level1 nicht (2 plots)
ef15 <- as.data.frame(ef15)

ef16 <- effect("region2:bus28", multinom_int2) #bei rural level1 nicht (2 plots)
ef16 <- as.data.frame(ef16)

ef17 <- effect("region2:tripsavg", multinom_int2) #bei rural level1 nicht (2 plots)
ef17 <- as.data.frame(ef17)

#effects plot normal mit plot
#quali_nv4: only urban rural significantnand only for levels 0 vs.1 and 0 vs. 2, other qualinvs not significant
#ef$variables$qualinv4$levels <- c("0", "4")
#plot(ef, multiline=TRUE, x.var = "qualinv4", rug=FALSE, colors = c("blue", "red", "orange", "transparent"))

#numlic
#plot(ef2, multiline=TRUE, x.var = "numlic", rug=FALSE, colors = c("blue", "red", "orange", "black"))

#income_numerical
#plot(effect("region2:income_numerical", multinom_int2), multiline=TRUE, x.var = "income_numerical", rug=FALSE)

#levels(ef$x$C) <- c("foo", "bar")

#https://stackoverflow.com/questions/20530232/change-factor-labels-on-effects-plot-in-r

```




Plots with ggplot - interaction terms
numlic
```{r}
#library(ggplot2)

#numlic 
Plot.numlic0<-ggplot(data=ef2, aes(x=numlic, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X0)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #geom_line(aes(y=prob.X3, color ="prob.X3"))+
      #scale_color_manual(labels = c("urban","suburban", "rural"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=L.prob.X0, ymax=U.prob.X0),linetype=0,alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      labs(color = "region") +
      #coord_fixed(ratio=10)+
  scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#Plot.numlic0

Plot.numlic1<-ggplot(data=ef2, aes(x=numlic, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X1)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #geom_line(aes(y=prob.X3, color ="prob.X3"))+
      #scale_color_manual(labels = c("urban","suburban", "rural"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=L.prob.X1, ymax=U.prob.X1),linetype=0,alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      labs(color = "region") +
      #coord_fixed(ratio=10)+
  scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.numlic1

Plot.numlic2<-ggplot(data=ef2, aes(x=numlic, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X2)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #geom_line(aes(y=prob.X3, color ="prob.X3"))+
      #scale_color_manual(labels = c("urban","suburban", "rural"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=L.prob.X2, ymax=U.prob.X2),linetype=0,alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      labs(color = "region") +
     # coord_fixed(ratio=10)+
  scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#Plot.numlic2

Plot.numlic3<-ggplot(data=ef2, aes(x=numlic, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X3)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #geom_line(aes(y=prob.X3, color ="prob.X3"))+
      #scale_color_manual(labels = c("urban","suburban", "rural"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=L.prob.X3, ymax=U.prob.X3),linetype=0,alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2)+
      #geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      labs(color = "region") +
      #coord_fixed(ratio=10)+
    scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#Plot.numlic3

```

```{r}
figure_numlic <- ggarrange(Plot.numlic0, Plot.numlic1, Plot.numlic2,Plot.numlic3,common.legend = TRUE, legend = "right", 
          labels = c("Zero cars", "One car", "Two cars","Three cars"),
          ncol = 2, nrow = 2)



annotate_figure(figure_numlic,
                top = text_grob("Number of license holders and region as predictors of car ownership", color = "black", size =                   14,),
                left = text_grob("Predicted Probability", color = "black", rot = 90),
                bottom = text_grob("Number of license holders"),
)

```



Income numerical

```{r}
#income (3 separate plot)
Plot.income0 <-ggplot(data=ef3, aes(x=income_numerical, group=region2, color=region2))+
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X0)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #geom_line(aes(y=prob.X3, color ="prob.X3"))+
      geom_ribbon(aes(ymin=prob.X0-se.prob.X0, ymax=prob.X0+se.prob.X0),alpha=.2, linetype=0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
      labs(color = "region") +
      coord_fixed(ratio=10)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.income0

Plot.income1 <-ggplot(data=ef3, aes(x=income_numerical, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X1)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #geom_line(aes(y=prob.X3, color ="prob.X3"))+
      geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2, linetype=0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=10)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#Plot.income1

Plot.income2 <-ggplot(data=ef3, aes(x=income_numerical, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X2)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #geom_line(aes(y=prob.X3, color ="prob.X3"))+
      geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2, linetype=0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=10)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#Plot.income2


Plot.income3 <-ggplot(data=ef3, aes(x=income_numerical, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X3)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #geom_line(aes(y=prob.X3, color ="prob.X3"))+
      geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2, linetype=0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=8)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#Plot.income3

```

```{r}
figure_income <- ggarrange(Plot.income0, Plot.income1, Plot.income2,common.legend = TRUE, legend = "right", 
          labels = c("Zero cars", "One car", "Two cars"), vjust=7,
          ncol = 4, nrow = 1)



annotate_figure(figure_income,
                top = text_grob("Monthly income and region as predictors of car ownership", color = "black", size =                   14, vjust=5),
                left = text_grob("Predicted Probability", color = "black", rot = 90),
                bottom = text_grob("Monthly Income", vjust=-8),
)



```

qualinv
```{r}
#qualinv4
Plot.qualinv1 <-ggplot(data=ef, aes(x=quali_nv, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X0)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X0-se.prob.X0, ymax=prob.X0+se.prob.X0),alpha=.2, linetype =0)+
      labs(color = "region") +
      ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=8)+
      scale_y_continuous(limits=c(0,0.5),breaks = c(0.1,0.2,0.3,0.4))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.qualinv1

Plot.qualinv2 <-ggplot(data=ef, aes(x=quali_nv, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X1)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2, linetype =0)+
      labs(color = "region") +
      ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=4)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.qualinv2

Plot.qualinv3 <-ggplot(data=ef, aes(x=quali_nv, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X2)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2, linetype =0)+
     labs(color = "region") +
      ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=4)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.qualinv3

Plot.qualinv4 <-ggplot(data=ef, aes(x=quali_nv, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X3)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2, linetype =0)+
      labs(color = "region") +
      ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=4)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.qualinv4
```

```{r}
#library(ggpubr)
figure <- ggarrange(Plot.qualinv1, Plot.qualinv2, Plot.qualinv3,common.legend = TRUE, legend = "right", 
          labels = c("Zero cars", "One car", "Two cars"), vjust=8,
          ncol = 3, nrow = 1)

annotate_figure(figure,
                top = text_grob("Quality of public services and region as predictors of car ownership", color = "black", size = 14, vjust=6),
                left = text_grob("Predicted Probability", color = "black", rot = 90),
                bottom = text_grob("Quality of public services", vjust=-8),
)



```


Csyes
```{r}
#CSyes
Plot.cs0 <-ggplot(data=ef4, aes(x=CSyes, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X0)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X0-se.prob.X0, ymax=prob.X0+se.prob.X0),alpha=.2, linetype =0)+
      labs(color = "region") +
      ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=2)+
      scale_y_continuous(limits=c(0,0.5),breaks = c(0.1,0.2,0.3,0.4,0.5))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),aspect.ratio=1)+
      scale_fill_grey()
#Plot.cs0

Plot.cs1 <-ggplot(data=ef4, aes(x=CSyes, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X1)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2, linetype =0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=2)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_x_discrete(labels = c("0" = "No", "1" = "Yes"))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.cs1


Plot.cs2 <-ggplot(data=ef4, aes(x=CSyes, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X2)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2, linetype =0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=2)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#Plot.cs2

Plot.cs3<-ggplot(data=ef4, aes(x=CSyes, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X3)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2, linetype =0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(), aspect.ratio=1)+
      scale_fill_grey()
#Plot.cs3
```

```{r}
figure <- ggarrange(Plot.cs0, Plot.cs1, Plot.cs2,common.legend = TRUE, legend = "right", 
          labels = c("Zero cars", "One car", "Two cars"), vjust=8,
          ncol = 3, nrow = 1)

annotate_figure(figure,
                top = text_grob("Carsharing and region as predictors of car ownership", color = "black", size = 14, vjust=6),
                left = text_grob("Predicted Probability", color = "black", rot = 90),
                bottom = text_grob("Carsharing Subscription", vjust=-8),
)



```



workers
```{r}
#CSyes
Plot.work0 <-ggplot(data=ef5, aes(x=workers, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X0)) + 
      labs(color = "region") +
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X0-se.prob.X0, ymax=prob.X0+se.prob.X0),alpha=.2, linetype =0)+
      ylab("P")+
      xlab("")+
      ggtitle("")+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
  coord_fixed(ratio=5)+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.work0

Plot.work1 <-ggplot(data=ef5, aes(x=workers, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X1)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2, linetype =0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
  coord_fixed(ratio=3)+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.work1

Plot.work2 <-ggplot(data=ef5, aes(x=workers, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X2)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2, linetype =0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
  coord_fixed(ratio=3)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#Plot.work2

Plot.work3<-ggplot(data=ef5, aes(x=workers, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X3)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2, linetype =0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=5)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.work3
```

```{r}
figure_work <- ggarrange( Plot.work1, Plot.work2, common.legend = TRUE, legend = "right", 
          labels = c( "One car", "Two cars", vjust=10),
          ncol = 2, nrow = 1)


annotate_figure(figure_work,
                top = text_grob("Number of workers and region as predictors of car ownership", color = "black", size = 14,vjust=6),
                left = text_grob("Predicted Probability", color = "black", rot = 90),
                bottom = text_grob("Number of workers", vjust=-6),
)
```


triplength_avg
```{r}
Plot.trip0 <-ggplot(data=ef6, aes(x=triplength_avg, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X0)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X0-se.prob.X0, ymax=prob.X0+se.prob.X0),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=30)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#Plot.trip0

Plot.trip1 <-ggplot(data=ef6, aes(x=triplength_avg, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X1)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=30)+
      labs(color = "region") +
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#Plot.trip1

Plot.trip2 <-ggplot(data=ef6, aes(x=triplength_avg, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X2)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=30)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
#Plot.trip2

Plot.trip3<-ggplot(data=ef6, aes(x=triplength_avg, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X3)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=30)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.trip3

```

```{r}
figure_trip <- ggarrange( Plot.trip1, Plot.trip2, common.legend = TRUE, legend = "right", 
          labels = c( "One car", "Two cars"), vjust=5,
          ncol = 2, nrow = 1)


annotate_figure(figure_trip,
                top = text_grob("Average triplength and region as predictors of car ownership", color = "black", size = 14, vjust=4),
                left = text_grob("Predicted Probability", color = "black", rot = 90),
                bottom = text_grob("Average triplength", vjust=-4),
)
```


share2039
```{r}
Plot.share0 <-ggplot(data=ef7, aes(x=share2039, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X0)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X0-se.prob.X0, ymax=prob.X0+se.prob.X0),alpha=.2, linetype =0)+
      labs(color = "region")+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=2)+
      scale_y_continuous(limits=c(0,0.5),breaks = c(0.1,0.2,0.3,0.4))+
      scale_x_continuous(limits=c(0,1),breaks = c(0.5))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.share0

Plot.share1 <-ggplot(data=ef7, aes(x=share2039, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X1)) + 
      labs(color = "region") +
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=1)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_x_continuous(limits=c(0,1),breaks = c(0.5))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.share1

Plot.share2 <-ggplot(data=ef7, aes(x=share2039, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X2)) +
      labs(color = "region")+
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=1)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      scale_x_continuous(limits=c(0,1),breaks = c(0.5))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.share2

Plot.share3<-ggplot(data=ef7, aes(x=share2039, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X3)) + 
      labs(color = "region")+
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2, linetype =0)+
      labs(color = "region")+
      scale_y_continuous(limits=c(0,0.5),breaks = c(0.1,0.2,0.3,0.4))+
      scale_x_continuous(limits=c(0,1),breaks = c(0.5))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.share3
```
```{r}
figure_share <- ggarrange( Plot.share0, Plot.share1, Plot.share2, Plot.share3, common.legend = TRUE, legend = "right", 
          labels = c("Zero cars", "One car", "Two cars", "Three cars"), vjust=10,
          ncol = 4, nrow = 1)


annotate_figure(figure_share,
                top = text_grob("Shareof 20 to 39 year olds and region as predictors of car ownership", color = "black", size = 14, vjust=8),
                left = text_grob("Predicted Probability", color = "black", rot = 90),
                bottom = text_grob("Share of 20 to 39 year olds", vjust=-10),
)
```

Share old

```{r}
Plot.share0 <-ggplot(data=ef7, aes(x=oldHH, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X0)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X0-se.prob.X0, ymax=prob.X0+se.prob.X0),alpha=.2, linetype =0)+
      labs(color = "region")+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=2)+
      scale_y_continuous(limits=c(0,0.5),breaks = c(0.1,0.2,0.3,0.4))+
      #scale_x_continuous(limits=c(0,1),breaks = c(0.5))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.share0

Plot.share1 <-ggplot(data=ef7, aes(x=oldHH, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X1)) + 
      labs(color = "region") +
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=1)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      #scale_x_continuous(limits=c(0,1),breaks = c(0.5))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.share1

Plot.share2 <-ggplot(data=ef7, aes(x=oldHH, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X2)) +
      labs(color = "region")+
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=1)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      #scale_x_continuous(limits=c(0,1),breaks = c(0.5))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.share2

Plot.share3<-ggplot(data=ef7, aes(x=oldHH, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X3)) + 
      labs(color = "region")+
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2, linetype =0)+
      labs(color = "region")+
      scale_y_continuous(limits=c(0,0.5),breaks = c(0.1,0.2,0.3,0.4))+
      #scale_x_continuous(limits=c(0,1),breaks = c(0.5))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.share3
```
```{r}
figure_share <- ggarrange( Plot.share0, Plot.share1, Plot.share2, Plot.share3, common.legend = TRUE, legend = "right", 
          labels = c("Zero cars", "One car", "Two cars", "Three cars"), vjust=10,
          ncol = 4, nrow = 1)


annotate_figure(figure_share,
                top = text_grob("Shareof 20 to 39 year olds and region as predictors of car ownership", color = "black", size = 14, vjust=8),
                left = text_grob("Predicted Probability", color = "black", rot = 90),
                bottom = text_grob("Share of 20 to 39 year olds", vjust=-10),
)
```


hh_children
```{r}
Plot.children0 <-ggplot(data=ef8, aes(x=hh_children, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X0)) + 
      labs(color = "region")+
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X0-se.prob.X0, ymax=prob.X0+se.prob.X0),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=1)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.children0

Plot.children1 <-ggplot(data=ef8, aes(x=hh_children, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X1)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
  labs(color = "region")+
      ggtitle("")+
      coord_fixed(ratio=1)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.children1

Plot.children2 <-ggplot(data=ef8, aes(x=hh_children, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X2)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
      ggtitle("")+
      coord_fixed(ratio=1)+
  labs(color = "region")+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.children2

Plot.children3<-ggplot(data=ef8, aes(x=hh_children, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X3)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2, linetype =0)+
       ylab("")+
      xlab("")+
      ggtitle("")+
  labs(color = "region")+
      coord_fixed(ratio=1)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.children3
```

```{r}
figure_children <- ggarrange( Plot.children1, Plot.children2, common.legend = TRUE, legend = "right", 
          labels = c( "One car", "Two cars"), vjust=8,
          ncol = 2, nrow = 1)


annotate_figure(figure_children,
                top = text_grob("Children and region as predictors of car ownership", color = "black", size = 14, vjust=6),
                left = text_grob("Predicted Probability", color = "black", rot = 90),
                bottom = text_grob("Households with children", vjust=-10),
)
```


numped
```{r}
Plot.ped0 <-ggplot(data=ef9, aes(x=numped, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X0)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X0-se.prob.X0, ymax=prob.X0+se.prob.X0),alpha=.2, linetype =0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
  labs(color = "region")+
      coord_fixed(ratio=10)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.ped0

Plot.ped1 <-ggplot(data=ef9, aes(x=numped, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X1)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X1-se.prob.X1, ymax=prob.X1+se.prob.X1),alpha=.2, linetype =0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
  labs(color = "region")+
      coord_fixed(ratio=10)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.ped1

Plot.ped2 <-ggplot(data=ef9, aes(x=numped, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X2)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X2-se.prob.X2, ymax=prob.X2+se.prob.X2),alpha=.2, linetype =0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
  labs(color = "region")+
      coord_fixed(ratio=10)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.ped2

Plot.ped3<-ggplot(data=ef9, aes(x=numped, group=region2, color=region2))+
#For ylim, specify the range of your DV (in our case, 0-4)
      #facet_wrap(~region2)+
      geom_line(aes(y=prob.X3)) + 
      #geom_line(aes(y=prob.X1, color="prob.X1")) + 
      #geom_line(aes(y=prob.X2, color ="prob.X2"))+
      #scale_color_manual(labels = c("0 car","1 car", "2 cars"),values= c("blue", "red", "orange"))+
      geom_ribbon(aes(ymin=prob.X3-se.prob.X3, ymax=prob.X3+se.prob.X3),alpha=.2, linetype =0)+
      ylab("")+
      xlab("")+
      ggtitle("")+
  labs(color = "region")+
      coord_fixed(ratio=10)+
      scale_y_continuous(limits=c(0,1),breaks = c(0.2,0.4,0.6,0.8))+
      theme_bw()+ 
        theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank())+
      scale_fill_grey()
Plot.ped3
```

```{r}
figure_ped <- ggarrange(Plot.ped0,Plot.ped1, Plot.ped2, common.legend = TRUE, legend = "right", 
          labels = c( "Zero cars","One car", "Two cars"), vjust=8,
          ncol = 3, nrow = 1)


annotate_figure(figure_ped,
                top = text_grob("Number of bicycles and region as predictors of car ownership", color = "black", size = 14, vjust=6),
                left = text_grob("Predicted Probability", color = "black", rot = 90),
                bottom = text_grob("Number of bicycles/pedelecs", vjust=-8),
)
```





Accuracy

```{r}
install.packages('interplot')
library(interplot)
# https://cran.r-project.org/web/packages/interplot/vignettes/interplot-vignette.html

# https://cran.r-project.org/web/packages/sjPlot/vignettes/plot_marginal_effects.html

#https://lost-stats.github.io/Presentation/marginal_effects_plots_for_interactions_with_continuous_variables.html

#interplot(m = fit_multinom, var1 = "trips", var2 = "income_numerical")


```
```{r}
ProbCat <- predict(fit_new)
categHat <- levels(HH_dt_2_out$numcars)[max.col(ProbCat)]

facHat <- factor(categHat, levels=levels(HH_dt_2_out$numcars))
cTab   <- table(HH_dt_2_out$numcars, facHat, dnn=c("Ycateg", "facHat"))
addmargins(cTab)

(CCR <- sum(diag(cTab)) / sum(cTab))


# mit interaction model 
ProbCat2 <- predict(fit_interaction)
categHat <- levels(HH_dt_2_out$numcars)[max.col(ProbCat2)]

facHat <- factor(categHat, levels=levels(HH_dt_2_out$numcars))
cTab   <- table(HH_dt_2_out$numcars, facHat, dnn=c("Ycateg", "facHat"))
addmargins(cTab)

(CCR <- sum(diag(cTab)) / sum(cTab))


```




